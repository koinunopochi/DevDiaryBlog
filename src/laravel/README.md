# Laravel コーディング規約

## 目的

<!-- そのコーディング規約の適用範囲、なぜ必要なのか、それを守ることによりどんなメリットがあるかを書きます。 -->

この規約は、Laravel フレームワークをベースに Domain-Driven Design (DDD)の要素を取り入れたプロジェクトにおけるコーディング標準を定義します。本規約の目的は以下の通りです：

1. コードの一貫性と可読性の向上
2. チーム内でのコミュニケーションの促進
3. 保守性と拡張性の高いコードベースの構築
4. DDD の概念を活用したドメイン中心の設計の促進

この規約を遵守することで、新人プログラマーを含むチーム全体が、より効率的に高品質なコードを生産することができます。

## プロジェクトの構成

<!-- コーディングにはあまり関係なさそうな内容ですが、ソースプログラムの先頭にコメントを入れたりするのに使います。プロジェクトの名称などはあらかじめ決まっていることが多いので、もし、そうなら一覧表を付けます。メタ情報の指定方法、フォルダの構成方法なども決めておきます。 -->

1. プロジェクトのルートディレクトリ構造は、Laravel の標準構造を基本としつつ、DDD の要素を取り入れた以下の構成を採用します：

```sh
app/
├── Domain/
│   ├── Entities/
│   ├── Exceptions/
│   ├── Repositories/
│   └── ValueObjects/
├── Application/
│   ├── DataTransferObjects/
│   ├── Jobs/
│   ├── Services/ # 複数のDomainObjectに対する操作の場合は、Serviceを使用する。
│   │             # 複数のUseCaseを呼び出す形で実装する
│   └── UseCases/ # 一つのDomainObjectに対する操作の場合は、UseCaseを使用する
├── Infrastructure/
│   ├── Common/ # 通常は利用しない
│   ├── Persistence/
│   └── AudioAPIClient.php
├── Exceptions/ # Laravelの標準ディレクトリ
├── Http/ # Laravelの標準ディレクトリ
│   ├── Controllers/
│   ├── Middleware/
│   └── Requests/
├── Models/ # Laravelの標準ディレクトリ- Eloquentモデルはここに配置し、Infrastructureで使用する
└── ...（その他のLaravelの標準ディレクトリ）
```

## 命名規則

<!-- 変数、定数、メソッド(関数)、クラスなどの名前の付け方の基準を決める。変数名の先頭は小文字だとか、クラス名の先頭は大文字だとかがよく使われます。 -->

1. 変数名：キャメルケース（例：`$userEmail`）
2. 関数名：キャメルケース（例：`getUserById()`）
3. クラス名：パスカルケース（例：`UserRepository`）
4. インターフェース名：パスカルケースで、先頭に「I」をつける（例：`IUserRepository`）
5. トレイト名：パスカルケースで、末尾に「Trait」をつける（例：`LoggableTrait`）
6. 定数：大文字のスネークケース（例：`USER_STATUS_ACTIVE`）

## コーディングスタイル

<!-- コーディングスタイルはインデントの仕方とか、中かっこの位置とか、コメントの位置や内容とかを決めておきます。 -->

基本的に vs code の Linter に従うこととします。

## リソース

<!-- エラーメッセージなどはハードコーディングしないで、よくリソースファイルのインデックスを指定したりします。もし使うなら、リソースの使用についての説明、制限なども書いておきましょう。（あまり大きいリソースの管理はたいへんなのでバランスを考えたほうがいいです。特に IDE を使う場合。） -->

必要に応じて新たに定義することとします。

## 禁止事項

<!-- 使ってはいけない文法や今はほとんど使われない保守用になっているものとかを挙げておきます。一律に禁止でなく、場合によっては例外も設けておきます。(なぜ禁止なのか、その理由も必ず書きます) -->

1. グローバル変数の使用（理由：スコープの管理が難しくなり、副作用を引き起こす可能性があるため）
2. 直接の DB クエリの実行（理由：リポジトリパターンを使用し、データアクセスを抽象化するため）

## 制限事項

<!-- あまり推奨されない機能、コーディング方法、クラスなどを揚げておきます。また、その条件を明示します。 -->

1. すべてのコントローラーは、リクエストの検証とレスポンスの返却のみを記述し、ビジネスロジックは適切なサービスクラスに委譲します。（理由：コントローラーは薄いクラスであるべきであり、ビジネスロジックはドメインサービスに記述するべきであるため）
2. すべての Controller・ApplicationService・ApplicationUseCase は、1 メソッドのみを持つ形に統一すること（理由：単一責任の原則に従い、コントローラーの責務を明確にするため）
3. Eloquent モデルには、属性や関係の定義のみを含め、ビジネスロジックは適切なドメインサービスに記述します。（理由：Eloquent モデルはデータアクセスのためのクラスであり、ビジネスロジックはドメインサービスに記述するべきであるため）
4. すべてのDomainObjectは、ValueObjectのみを使用して、不変性を保証すること（理由：不変性を保証することで、バグの発生を防ぎ、コードの信頼性を向上させるため）

## 推奨事項

<!-- 好ましいコーディング方法や複数の似たようなクラスや関数などがある場合、どちらが推奨されるかを書いておきます。 -->

1. 型宣言を積極的に使用し、メソッドの引数と戻り値の型を明示します。
2. 値オブジェクトを使用して、ドメインの概念を表現します（例：`Email`、`Money`）。
3. ドメインイベントを使用して、ドメイン内の重要な変更を表現し、疎結合なシステムを構築します。
4. 単一責任の原則に従い、クラスやメソッドの責務を明確に分離します。
5. テストを書く際は、[Given-When-Then パターン](https://zenn.dev/miya_tech/articles/4e0de8046f88bf)を使用し、テストの意図を明確にします。

この規約は、プロジェクトの進行に伴い、チームの合意のもとで適宜更新・改訂されるべきです。
